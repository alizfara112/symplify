#!/usr/bin/env php
<?php declare(strict_types=1);

require_once __DIR__ . '/monorepo-bootstrap.php';

use Symfony\Component\Console\Input\ArgvInput;
use Symplify\Monorepo\Configuration\ConfigurationOptions;
use Symplify\Monorepo\Console\Application;
use Symplify\Monorepo\DependencyInjection\ContainerFactory;
use Symplify\PackageBuilder\Configuration\ConfigFilePathHelper;
use Symplify\PackageBuilder\Console\Style\SymfonyStyleFactory;

try {
    // Detect configuration
    ConfigFilePathHelper::detectFromInput('monorepo', new ArgvInput());
    $configFile = ConfigFilePathHelper::provide('monorepo', ConfigurationOptions::MONOREPO_CONFIG_FILE);

    $containerFactory = new ContainerFactory();
    if ($configFile) {
        $container = $containerFactory->createWithConfig($configFile);
    } else {
        $container = $containerFactory->create();
    }

    /** @var Application $application */
    $application = $container->get(Application::class);
    $application->run();
} catch (Throwable $throwable) {
    $symfonyStyle = SymfonyStyleFactory::create();
    $symfonyStyle->error($throwable->getMessage());
    exit(1);
}
