#!/usr/bin/env php
<?php declare(strict_types=1);

require_once __DIR__ . '/changelog-linker-bootstrap.php';

use Symplify\ChangelogLinker\Command\RunCommand;
use Symplify\ChangelogLinker\Console\Application;
use Symplify\ChangelogLinker\DependencyInjection\ContainerFactory;
use Symplify\PackageBuilder\Console\Command\CommandNaming;
use Symplify\PackageBuilder\Console\ThrowableRenderer;

try {
    $config = null;
    $argvInput = new Symfony\Component\Console\Input\ArgvInput;
    if ($argvInput->hasParameterOption('--config')) {
        $config = $argvInput->getParameterOption('--config');
    }

    if ($config) {
        $container = (new ContainerFactory)->createWithConfig($config);
    } else {
        $container = (new ContainerFactory)->create();
    }

    $application = $container->get(Application::class);
    $application->setDefaultCommand(CommandNaming::classToName(RunCommand::class), true);
    $application->run();
} catch (Throwable $throwable) {
    (new ThrowableRenderer())->render($throwable);
}
